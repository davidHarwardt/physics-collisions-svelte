var ti=Object.defineProperty;var ii=(s,e,t)=>e in s?ti(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t;var z=(s,e,t)=>(ii(s,typeof e!="symbol"?e+"":e,t),t);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))n(i);new MutationObserver(i=>{for(const r of i)if(r.type==="childList")for(const l of r.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&n(l)}).observe(document,{childList:!0,subtree:!0});function t(i){const r={};return i.integrity&&(r.integrity=i.integrity),i.referrerpolicy&&(r.referrerPolicy=i.referrerpolicy),i.crossorigin==="use-credentials"?r.credentials="include":i.crossorigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function n(i){if(i.ep)return;i.ep=!0;const r=t(i);fetch(i.href,r)}})();function Q(){}function Lt(s){return s()}function zt(){return Object.create(null)}function re(s){s.forEach(Lt)}function ni(s){return typeof s=="function"}function Ye(s,e){return s!=s?e==e:s!==e||s&&typeof s=="object"||typeof s=="function"}function si(s){return Object.keys(s).length===0}function ri(s,...e){if(s==null)return Q;const t=s.subscribe(...e);return t.unsubscribe?()=>t.unsubscribe():t}function li(s,e,t){s.$$.on_destroy.push(ri(e,t))}function u(s,e){s.appendChild(e)}function te(s,e,t){s.insertBefore(e,t||null)}function J(s){s.parentNode.removeChild(s)}function x(s){return document.createElement(s)}function ne(s){return document.createTextNode(s)}function w(){return ne(" ")}function W(s,e,t,n){return s.addEventListener(e,t,n),()=>s.removeEventListener(e,t,n)}function oi(s){return function(e){return e.preventDefault(),s.call(this,e)}}function C(s,e,t){t==null?s.removeAttribute(e):s.getAttribute(e)!==t&&s.setAttribute(e,t)}function ai(s){return Array.from(s.childNodes)}function ze(s,e){e=""+e,s.wholeText!==e&&(s.data=e)}let ve;function pe(s){ve=s}function ui(){if(!ve)throw new Error("Function called outside component initialization");return ve}function di(s){ui().$$.on_mount.push(s)}const fe=[],$=[],Ce=[],je=[],ci=Promise.resolve();let Ve=!1;function hi(){Ve||(Ve=!0,ci.then(Ft))}function He(s){Ce.push(s)}function O(s){je.push(s)}const Oe=new Set;let Ee=0;function Ft(){const s=ve;do{for(;Ee<fe.length;){const e=fe[Ee];Ee++,pe(e),fi(e.$$)}for(pe(null),fe.length=0,Ee=0;$.length;)$.pop()();for(let e=0;e<Ce.length;e+=1){const t=Ce[e];Oe.has(t)||(Oe.add(t),t())}Ce.length=0}while(fe.length);for(;je.length;)je.pop()();Ve=!1,Oe.clear(),pe(s)}function fi(s){if(s.fragment!==null){s.update(),re(s.before_update);const e=s.dirty;s.dirty=[-1],s.fragment&&s.fragment.p(s.ctx,e),s.after_update.forEach(He)}}const Pe=new Set;let ie;function gi(){ie={r:0,c:[],p:ie}}function pi(){ie.r||re(ie.c),ie=ie.p}function D(s,e){s&&s.i&&(Pe.delete(s),s.i(e))}function q(s,e,t,n){if(s&&s.o){if(Pe.has(s))return;Pe.add(s),ie.c.push(()=>{Pe.delete(s),n&&(t&&s.d(1),n())}),s.o(e)}else n&&n()}function j(s,e,t){const n=s.$$.props[e];n!==void 0&&(s.$$.bound[n]=t,t(s.$$.ctx[n]))}function V(s){s&&s.c()}function R(s,e,t,n){const{fragment:i,on_mount:r,on_destroy:l,after_update:o}=s.$$;i&&i.m(e,t),n||He(()=>{const f=r.map(Lt).filter(ni);l?l.push(...f):re(f),s.$$.on_mount=[]}),o.forEach(He)}function A(s,e){const t=s.$$;t.fragment!==null&&(re(t.on_destroy),t.fragment&&t.fragment.d(e),t.on_destroy=t.fragment=null,t.ctx=[])}function mi(s,e){s.$$.dirty[0]===-1&&(fe.push(s),hi(),s.$$.dirty.fill(0)),s.$$.dirty[e/31|0]|=1<<e%31}function qt(s,e,t,n,i,r,l,o=[-1]){const f=ve;pe(s);const a=s.$$={fragment:null,ctx:null,props:r,update:Q,not_equal:i,bound:zt(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(e.context||(f?f.$$.context:[])),callbacks:zt(),dirty:o,skip_bound:!1,root:e.target||f.$$.root};l&&l(a.root);let y=!1;if(a.ctx=t?t(s,e.props||{},(_,b,...I)=>{const E=I.length?I[0]:b;return a.ctx&&i(a.ctx[_],a.ctx[_]=E)&&(!a.skip_bound&&a.bound[_]&&a.bound[_](E),y&&mi(s,_)),b}):[],a.update(),y=!0,re(a.before_update),a.fragment=n?n(a.ctx):!1,e.target){if(e.hydrate){const _=ai(e.target);a.fragment&&a.fragment.l(_),_.forEach(J)}else a.fragment&&a.fragment.c();e.intro&&D(s.$$.fragment),R(s,e.target,e.anchor,e.customElement),Ft()}pe(f)}class Wt{$destroy(){A(this,1),this.$destroy=Q}$on(e,t){const n=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return n.push(t),()=>{const i=n.indexOf(t);i!==-1&&n.splice(i,1)}}$set(e){this.$$set&&!si(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}class Rt{constructor(...e){this.v=e}_makeThis(){return new this.__proto__.constructor(new Array(this.v.length).fill(0))}map(e){const t=this._makeThis();for(var n=0;n<this.v.length;n++)t.v[n]=e(this.v[n],n);return t}zipMap(e,t){return this.map((n,i)=>t(n,e.v[i],i))}reduce(e,t){let n=t;for(var i=0;i<this.v.length;i++)n=e(n,this.v[i],i);return n}zipReduce(e,t,n){return this.reduce((i,r,l)=>t(i,r,e.v[l],l),n)}copy(){return this.map(e=>e)}add(e){return this.zipMap(e,(t,n)=>t+n)}sub(e){return this.zipMap(e,(t,n)=>t-n)}mult(e){return this.zipMap(e,(t,n)=>t*n)}div(e){return this.zipMap(e,(t,n)=>t/n)}addS(e){return this.map(t=>t+e)}subS(e){return this.map(t=>t-e)}multS(e){return this.map(t=>t*e)}divS(e){return this.map(t=>t/e)}dot(e){return this.zipReduce(e,(t,n,i)=>t+n*i,0)}sqrMagnitude(){return this.dot(this)}magnitude(){return Math.sqrt(this.dot(this))}normalized(){return this.divS(this.magnitude())}inverted(){return this.multS(-1)}lerp(e,t){return this.multS(1-t).add(e.multS(t))}toArray(){return this.v.slice()}multM(e){return this.map((t,n)=>{let i=0;for(let r=0;r<e.rows;r++)i+=t*e.at(r,n);return i})}}class m extends Rt{constructor(e,t){super(e,t)}get x(){return this.v[0]}get y(){return this.v[1]}set x(e){this.v[0]=e}set y(e){this.v[1]=e}}class Tt extends Rt{constructor(e,t,n){super(e,t,n)}get x(){return this.v[0]}get y(){return this.v[1]}get z(){return this.v[2]}set x(e){this.v[0]=e}set y(e){this.v[1]=e}set z(e){this.v[2]=e}}class vi{constructor(...e){this.v=e}_makeThis(){return this.__proto__.constructor(new Array(this.v.length).fill(0))}map(e){const t=this._makeThis();for(var n=0;n<this.v.length;n++)t.v[n]=e(this.v[n],n);return t}zipMap(e,t){return this.map((n,i)=>t(n,e.v[i],i))}reduce(e,t){let n=t;for(var i=0;i<this.v.length;i++)n=e(n,this.v[i],i);return n}zipReduce(e,t,n){return this.reduce((i,r,l)=>t(i,r,e.v[l],l),n)}copy(){return this.map(e=>e)}add(e){return this.zipMap(e,(t,n)=>t+n)}sub(e){return this.zipMap(e,(t,n)=>t-n)}mult(e){return this.zipMap(e,(t,n)=>t*n)}div(e){return this.zipMap(e,(t,n)=>t/n)}addS(e){return this.map(t=>t+e)}subS(e){return this.map(t=>t-e)}multS(e){return this.map(t=>t*e)}divS(e){return this.map(t=>t/e)}dot(e){return this.zipReduce(e,(t,n,i)=>t+n*i,0)}sqrMagnitude(){return this.dot(this)}magnitude(){return Math.sqrt(this.dot(this))}normalized(){return this.divS(this.magnitude())}inverted(){return this.multS(-1)}lerp(e,t){return this.multS(1-t).add(e.multS(t))}toArray(){return this.v.slice()}multM(e){return this.map((t,n)=>{let i=0;for(let r=0;r<e.rows;r++)i+=t*e.at(r,n);return i})}}class wi extends vi{constructor(e,t,n,i){super(e,t,n,i)}get x(){return this.v[0]}get y(){return this.v[1]}get z(){return this.v[2]}get w(){return this.v[3]}set x(e){this.v[0]=e}set y(e){this.v[1]=e}set z(e){this.v[2]=e}set w(e){this.v[3]=e}}function _i(s,e,t){return Math.min(Math.max(s,e),t)}class v{constructor(e,t,n,i=1){this.v=new wi(e,t,n,i)}static get black(){return new v(0,0,0)}static get white(){return new v(1,1,1)}static get red(){return new v(1,0,0)}static get green(){return new v(0,1,0)}static get blue(){return new v(0,0,1)}static hex(e){if(typeof e=="number")return new v((e>>8*2&255)/255,(e>>8*1&255)/255,(e>>8*0&255)/255);if(!e.startsWith("#")||e.length!==7&&e.length!==9)throw new Error("invalid color string");let t=new Array((e.length-1)/2);for(let n=0;n<(e.length-1)/2;n++)t[n]=parseInt(e.substring(2*n+1,2*n+3),16)/255;return new v(t[0],t[1],t[2],t==null?void 0:t[3])}static hsl(e,t,n){}static vec(e){return new v(e.x,e.y,e.z,e.w)}hexComponent(e){return Math.floor(_i(e,0,1)*255).toString(16).padStart(2,"0")}toRgbString(e=this.a!==1){return`rgb${e?"a":""}(${Math.floor(this.r*255)}, ${Math.floor(this.g*255)}, ${Math.floor(this.b*255)}${e?", "+Math.floor(this.a*255):""})`}toHexString(e=this.a!==1){return`#${this.hexComponent(this.r)}${this.hexComponent(this.g)}${this.hexComponent(this.b)}${e?this.hexComponent(this.a):""}`}toString(){return this.toHexString()}toVec(){return this.v.copy()}toArray(){return this.v.toArray()}mix(e,t=.5){const n=new v(0,0,0,0);return n.v=this.v.multS(t).add(e.v.multS(1-t)),n}withAlpha(e){const t=this.clone();return t.a=e,t}get r(){return this.v.x}get g(){return this.v.y}get b(){return this.v.z}get a(){return this.v.w}set r(e){this.v.x=e}set g(e){this.v.y=e}set b(e){this.v.z=e}set a(e){this.v.w=e}clone(){return new v(this.r,this.g,this.b,this.a)}}class Te{constructor(e){this.element=e,this.ctx=this.element.getContext("2d"),this.plugins=[]}static fromParent(e){const t=document.createElement("canvas");return e.appendChild(t),new Te(t)}addPlugin(e){this.plugins.push(e)}clear(){this.ctx.clearRect(0,0,this.element.width,this.element.height)}beginDraw(){this.plugins.forEach(e=>e.beforeDrawBegin(this))}endDraw(){this.plugins.forEach(e=>e.afterDrawEnd(this))}draw(e){e(this.ctx)}drawLine(e,t,n={}){var i,r,l,o;this.ctx.lineWidth=(i=n.width)!==null&&i!==void 0?i:10,this.ctx.strokeStyle=(l=(r=n.color)===null||r===void 0?void 0:r.toString())!==null&&l!==void 0?l:v.red.toString(),this.ctx.lineCap=(o=n.cap)!==null&&o!==void 0?o:"butt",this.ctx.beginPath(),this.ctx.moveTo(e.x,e.y),this.ctx.lineTo(t.x,t.y),this.ctx.stroke()}drawRect(e,t,n={}){var i,r,l,o;this.ctx.beginPath(),this.ctx.rect(e.x,e.y,t.x,t.y),n.fill!==!1&&(this.ctx.fillStyle=(r=(i=n.color)===null||i===void 0?void 0:i.toString())!==null&&r!==void 0?r:v.green.toString(),this.ctx.fill()),n.borderWidth>0&&(this.ctx.strokeStyle=(o=(l=n.borderColor)===null||l===void 0?void 0:l.toString())!==null&&o!==void 0?o:v.red.toString(),this.ctx.lineWidth=n.borderWidth,this.ctx.stroke())}drawCircle(e,t,n={}){var i,r,l,o;this.ctx.beginPath(),this.ctx.arc(e.x,e.y,t,0,Math.PI*2),n.fill!==!1&&(this.ctx.fillStyle=(r=(i=n.color)===null||i===void 0?void 0:i.toString())!==null&&r!==void 0?r:v.green.toString(),this.ctx.fill()),n.borderWidth>0&&(this.ctx.strokeStyle=(o=(l=n.borderColor)===null||l===void 0?void 0:l.toString())!==null&&o!==void 0?o:v.red.toString(),this.ctx.lineWidth=n.borderWidth,this.ctx.stroke())}drawPoly(e,t={}){var n,i,r,l;if(e.length<2){console.error(`invalid vertex count for polygon: ${e.length}`);return}this.ctx.beginPath(),this.ctx.moveTo(e[0].x,e[0].y);for(let o=1;o<e.length;o++)this.ctx.lineTo(e[o].x,e[o].y);t.closed===!0&&this.ctx.closePath(),t.fill!==!1&&(this.ctx.fillStyle=(i=(n=t.color)===null||n===void 0?void 0:n.toString())!==null&&i!==void 0?i:v.green.toString(),this.ctx.fill()),t.borderWidth>0&&(this.ctx.strokeStyle=(l=(r=t.borderColor)===null||r===void 0?void 0:r.toString())!==null&&l!==void 0?l:v.red.toString(),this.ctx.lineWidth=t.borderWidth,this.ctx.stroke())}drawBezier(e,t={}){}drawText(e,t,n={}){var i,r,l,o,f,a;this.ctx.fillStyle=(r=(i=n.color)===null||i===void 0?void 0:i.toString())!==null&&r!==void 0?r:v.white.toString(),this.ctx.textAlign=(l=n.align)!==null&&l!==void 0?l:"left",this.ctx.font=`${(o=n.size)!==null&&o!==void 0?o:50}px ${(f=n.font)!==null&&f!==void 0?f:"Arial"}`,this.ctx.textBaseline=(a=n.baseLine)!==null&&a!==void 0?a:"top",n.debug&&this.ctx.measureText(e),this.ctx.fillText(e,t.x,t.y,n.maxWidth)}drawImage(e,t,n=new m(e.width,e.height),i){i?this.ctx.drawImage(e,i.start.x,i.start.y,i.dim.x,i.dim.y,t.x,t.y,n.x,n.y):this.ctx.drawImage(e,t.x,t.y,n.x,n.y)}translate(e){this.ctx.translate(e.x,e.y)}scale(e,t){t&&this.translate(t),this.ctx.scale(e.x,e.y),t&&this.translate(t.inverted())}rotate(e,t){t&&this.translate(t),this.ctx.rotate(e),t&&this.translate(t.inverted())}resetTransform(){this.ctx.resetTransform()}saveCtx(){this.ctx.save()}restoreCtx(){this.ctx.restore()}screenToWorld(e){const t=this.ctx.getTransform().inverse();return new m(t.a*e.x+t.c*e.y+t.e,t.b*e.x+t.d*e.y+t.f)}worldToScreen(e){const t=this.ctx.getTransform();return new m(t.a*e.x+t.c*e.y+t.e,t.b*e.x+t.d*e.y+t.f)}clipRect(e,t){this.clip(n=>n.rect(e.x,e.y,t.x,t.y))}clipCircle(e,t){this.clip(n=>n.arc(e.x,e.y,t,0,Math.PI*2))}clip(e){this.ctx.beginPath(),e(this.ctx),this.ctx.clip()}getImageData(e,t=new m(1,1)){return this.ctx.getImageData(e.x,e.y,t.x,t.y)}createImageData(e){return this.ctx.createImageData(e.x,e.y)}putImageData(e,t){this.ctx.putImageData(e,t.x,t.y)}getPixel(e){console.error("todo")}}class bi{constructor(e,t=n=>{}){this.onResize=t,this.element=e}}class xi extends bi{constructor(e,t){super(e,t),new ResizeObserver(i=>{let r=new m(this.element.width,this.element.height);for(const l of i)this.element.width=l.contentRect.width,this.element.height=l.contentRect.height;this.onResize(new m(this.element.width,this.element.height),r)}).observe(this.element)}}class kt extends xi{constructor(e,t){super(e,t),e.style.width="100%",e.style.height="100%"}}const ae=[];function Dt(s,e=Q){let t;const n=new Set;function i(o){if(Ye(s,o)&&(s=o,t)){const f=!ae.length;for(const a of n)a[1](),ae.push(a,s);if(f){for(let a=0;a<ae.length;a+=2)ae[a][0](ae[a+1]);ae.length=0}}}function r(o){i(o(s))}function l(o,f=Q){const a=[o,f];return n.add(a),n.size===1&&(t=e(i)||Q),o(s),()=>{n.delete(a),n.size===0&&(t(),t=null)}}return{set:i,update:r,subscribe:l}}class yi{constructor(e,t){z(this,"id");z(this,"pos");z(this,"lastPos");z(this,"data",{});this.pos=e,this.id=t,this.lastPos=e.copy()}setPos(e){this.pos=e}delta(){let e=this.pos.sub(this.lastPos);return this.lastPos=this.pos,e}}const ue=class{constructor(e){z(this,"parent");z(this,"pointers");z(this,"down",()=>{});z(this,"move",()=>{});z(this,"up",()=>{});this.parent=e,this.pointers=new Map,this.parent.addEventListener("touchstart",t=>{this.beginPointer(this.fromList(t.changedTouches))},{passive:!1}),this.parent.addEventListener("touchmove",t=>{t.preventDefault(),this.movePointer(this.fromList(t.changedTouches))},{passive:!1}),this.parent.addEventListener("touchend",t=>{this.removePointer(this.fromList(t.changedTouches))},{passive:!1}),this.parent.addEventListener("touchcancel",t=>{this.removePointer(this.fromList(t.changedTouches))}),this.parent.addEventListener("mousedown",t=>{this.beginPointer([{id:ue.POINTER_ID,pos:new m(t.clientX,t.clientY)}])},{passive:!1}),this.parent.addEventListener("mousemove",t=>{this.movePointer([{id:ue.POINTER_ID,pos:new m(t.clientX,t.clientY)}])},{passive:!1}),this.parent.addEventListener("mouseup",t=>{this.removePointer([{id:ue.POINTER_ID,pos:new m(t.clientX,t.clientY)}])},{passive:!1}),this.parent.addEventListener("mouseleave",t=>{this.removePointer([{id:ue.POINTER_ID,pos:new m(t.clientX,t.clientY)}])})}fromList(e){return new Array(e.length).fill(0).map((t,n)=>({id:e[n].identifier,pos:new m(e[n].clientX,e[n].clientY)}))}beginPointer(e){e.forEach(t=>{this.pointers.set(t.id,new yi(t.pos,t.id))}),this.down(e,this.pointers)}movePointer(e){e.forEach(t=>{var n;(n=this.pointers.get(t.id))==null||n.setPos(t.pos)}),this.move(e)}removePointer(e){e.forEach(t=>{this.pointers.delete(t.id)}),this.up(e,this.pointers)}};let Ie=ue;z(Ie,"POINTER_ID",-1);let d={editingCircle:{radius:50,mass:1},running:!0,traceFreq:20,drawTraces:!0,traceWidth:1/2,world:{restetution:1,motionEnabledStore:Dt(!1),motionEnabled:!1,gravity:25,velocity:25},selectedStore:Dt(void 0),stepsPerFrame:10},ge=200,P,we,Me,At=0,L,Nt=0,S,Ot=new m(0,0),me=new m(0,0);function Xe(){return Nt}function jt(){we.clear()}function Vt(){if(S){let s=F.findIndex(e=>e===S);F.splice(s,1),d.selectedStore.set(void 0),S=void 0}}const Si={"2-object-collision":()=>{let s=100,e=window.innerHeight/4,t=new m(s,window.innerHeight/2-e),n=new m(s,window.innerHeight/2+e),i=new m(window.innerWidth/2,window.innerHeight/2),r=new se(t,d.editingCircle.radius,d.editingCircle.mass);r.vel=i.sub(t);let l=new se(n,d.editingCircle.radius,d.editingCircle.mass);return l.vel=i.sub(n),[r,l]}};function Ht(s){F=Si[s](),S=void 0}function Xt(s){we=Te.fromParent(s),P=Te.fromParent(s),new kt(P.element),new kt(we.element),Me=new Ie(P.element),Me.down=(n,i)=>{let r=new m(window.innerWidth,window.innerHeight).subS(ge/2);n.forEach(l=>{if(l.pos.sub(r).magnitude()<d.editingCircle.radius&&(L={pos:r.copy(),pointer:l.id}),S&&S.pos.add(S.vel.divS(10)).sub(l.pos).magnitude()<S.radius){i.get(l.id).data.draggingVel=S;return}F.forEach(o=>{o.pos.sub(l.pos).magnitude()<o.radius&&(i.get(l.id).data.dragging=o)})})},Me.up=n=>{n.forEach(i=>{L&&L.pointer===i.id&&(Bt()&&F.push(new se(L.pos,d.editingCircle.radius,d.editingCircle.mass)),L=void 0)})},P.element.addEventListener("click",n=>{let i=new m(n.clientX,n.clientY);for(const r of F)if(r.pos.sub(i).magnitude()<r.radius){S=r,d.selectedStore.set(S);return}d.selectedStore.set(void 0),S=void 0});let e=Date.now()/1e3;const t=()=>{const n=Date.now()/1e3,i=n-e;Ei(i),requestAnimationFrame(t),e=n,Nt=1/i};requestAnimationFrame(t)}function Yt(){if(d.world.motionEnabled)d.world.motionEnabledStore.set(!1),d.world.motionEnabled=!1;else{if(!("DeviceMotionEvent"in window)){alert("DeviceMotionEvent not supported");return}DeviceMotionEvent.requestPermission().then(s=>{if(s!=="granted"){alert("permission for DeviceMotionEvent not granted");return}d.world.motionEnabledStore.set(!0),d.world.motionEnabled=!0,window.addEventListener("devicemotion",e=>{let t=new Tt(e.accelerationIncludingGravity.x,e.accelerationIncludingGravity.y,e.accelerationIncludingGravity.z),n=new Tt(e.acceleration.x,e.acceleration.y,e.acceleration.z),i=t.sub(n);Ot=new m(i.y,i.x).multS(-20*d.world.gravity),me=new m(n.y,n.x).multS(-2*d.world.velocity)})})}}function Bt(){for(const s of F)if(s.pos.sub(L.pos).magnitude()<s.radius+d.editingCircle.radius)return!1;return!0}const ke=class{constructor(e,t,n){z(this,"id",ke.id++);z(this,"pos");z(this,"oldPos");z(this,"vel");z(this,"radius");z(this,"mass");this.pos=e,this.vel=new m(0,0),this.radius=t,this.mass=n}get impulse(){return this.vel.multS(this.mass)}set impulse(e){this.vel=e.divS(this.mass)}update(e,t){let n=this.pos.add(this.vel.multS(e)),i=this.vel.copy();t.forEach(f=>{P.drawCircle(f.position,10,{color:v.blue}),P.drawLine(f.position,f.position.add(f.normal.multS(20)));const a=n.sub(f.position);let y=1/this.mass,_=1/f.other.mass,b=f.other.vel.sub(this.vel).dot(f.normal),I=d.world.restetution,E=-(1+I)*b/(y+_);i=this.vel.sub(f.normal.multS(E*y)),n=ke.reflect(a,f.normal).add(f.position)}),this.oldPos=this.pos,this.pos=n,this.vel=i;let r=1e-5,l=.47,o=this.vel.magnitude()*(-r*l*this.radius);this.vel=this.vel.add(this.vel.multS(e*o)),d.world.motionEnabled&&(this.vel=this.vel.add(Ot.multS(e)),this.vel=this.vel.add(me))}static reflect(e,t){return e.sub(t.multS(2*e.dot(t)))}getAllCollisions(e,t,n){return[...this.getCollisions(this.pos,e),...this.getWallCollision(n,this.pos)]}getCollisions(e,t){let n=[];return t.forEach(i=>{if(i!==this&&i.pos.sub(e).magnitude()<i.radius+this.radius){let r=i.pos.sub(e).normalized(),l=e.lerp(i.pos,this.radius/(this.radius+i.radius)).add(r.multS(-this.radius));n.push({normal:r,position:l,other:{vel:i.vel.copy(),mass:i.mass}})}}),n}getWallCollision(e,t){let n=[],i=this.getOvershoot(t,e),r=i.map(l=>-Math.sign(l));if(r.x!==0){r=new m(r.x,0);let l=t.sub(i);n.push({normal:r,position:l,other:{vel:new m(0,0),mass:Number.POSITIVE_INFINITY}})}if(r.y!==0){r=new m(0,r.y);let l=t.sub(i);n.push({normal:r,position:l,other:{vel:new m(0,0),mass:Number.POSITIVE_INFINITY}})}return n}getOvershoot(e,t){let n=this.outsideRect(e,t);return new m(n.left?e.x-this.radius:n.right?e.x-t.x+this.radius:0,n.top?e.y-this.radius:n.bottom?e.y-t.y+this.radius:0)}outsideRect(e,t){let n=e.x-this.radius<0,i=e.x+this.radius>t.x,r=e.y-this.radius<0,l=e.y+this.radius>t.y;return{genral:n||i||r||l,x:n||i,y:r||l,left:n,right:i,top:r,bottom:l}}lateUpdate(e){}draw(e,t){if(e.drawCircle(this.pos,this.radius),!d.running){let n=this.pos,i=n.add(this.vel.divS(10));e.drawLine(n,i,{cap:"round",width:12,color:v.white})}}bgDraw(e,t){if(d.drawTraces){let n=1/d.traceFreq;At%n<d.traceWidth*n&&t.drawLine(this.oldPos,this.pos,{width:2})}}};let se=ke;z(se,"id",0);let F=[];function Ei(s){P.clear(),P.beginDraw();const e=new m(window.innerWidth,window.innerHeight),t=new m(e.x-ge,e.y);if(d.running){me=me.divS(d.stepsPerFrame);for(let i=0;i<d.stepsPerFrame;i++){let r=s/d.stepsPerFrame,l=F.map(o=>o.getAllCollisions(F,r,t));F.forEach((o,f)=>o.update(r,l[f])),F.forEach(o=>o.bgDraw(P,we)),At+=r}}F.forEach(i=>i.draw(P,we)),me=new m(0,0),P.drawRect(new m(e.x-ge,0),new m(ge,e.y),{color:v.hex("#111111")});let n=e.subS(ge/2);if(P.drawCircle(n,d.editingCircle.radius),L&&P.drawCircle(L.pos,d.editingCircle.radius,{color:Bt()?v.hex("#005500"):v.hex("#333333")}),S)if(P.drawCircle(S.pos,S.radius+10,{borderColor:v.red,borderWidth:3,fill:!1}),d.running)P.drawLine(S.pos,S.pos.add(S.vel.divS(10)),{width:12,cap:"round",color:v.white}),P.drawLine(S.pos,S.pos.add(S.vel.divS(10)),{width:8,cap:"round",color:v.hex("#23393d")});else{let i=S.pos,r=i.add(S.vel.divS(10));P.drawLine(i,r,{cap:"round",width:12,color:v.white}),P.drawCircle(r,20,{color:v.white})}Me.pointers.forEach(i=>{const r=i.delta();if(P.drawCircle(i.pos,10,{color:v.hex("#555555")}),L&&L.pointer===i.id&&(L.pos=L.pos.add(r)),i.data.dragging){let l=i.data.dragging;d.running?l.vel=r.divS(s):l.pos=l.pos.add(r)}if(i.data.draggingVel){let l=i.data.draggingVel;l.vel=l.vel.add(r.multS(10))}}),P.endDraw()}const N=Object.freeze(Object.defineProperty({__proto__:null,init:Xt,settings:d,getFramerate:Xe,clearPaper:jt,enableMotion:Yt,removeSelected:Vt,useExperiment:Ht,CircleObject:se},Symbol.toStringTag,{value:"Module"}));function Ci(s){var _;let e,t,n,i,r,l,o=((_=s[2])!=null?_:"")+"",f,a,y;return{c(){e=x("div"),t=x("div"),n=ne(s[1]),i=ne(`:
        `),r=x("input"),l=w(),f=ne(o),C(r,"type","number"),r.value=s[0],C(r,"class","svelte-121lgjv"),C(t,"class","label svelte-121lgjv"),C(e,"class","slider")},m(b,I){te(b,e,I),u(e,t),u(t,n),u(t,i),u(t,r),s[10](r),u(t,l),u(t,f),a||(y=[W(r,"input",s[11]),W(e,"pointerdown",s[4]),W(e,"pointermove",oi(s[6])),W(e,"pointerup",s[5]),W(e,"pointercancel",s[5]),W(e,"pointerleave",s[5])],a=!0)},p(b,[I]){var E;I&2&&ze(n,b[1]),I&1&&r.value!==b[0]&&(r.value=b[0]),I&4&&o!==(o=((E=b[2])!=null?E:"")+"")&&ze(f,o)},i:Q,o:Q,d(b){b&&J(e),s[10](null),a=!1,re(y)}}}function Pi(s,e,t){let{label:n}=e,{value:i}=e,{min:r=void 0}=e,{max:l=void 0}=e,{step:o=1}=e,{unit:f=void 0}=e,a,y;function _(g){g.currentTarget.setPointerCapture(g.pointerId),y=g.clientX}function b(g){y=void 0}function I(g){if(y!==void 0){let p=g.clientX-y;t(0,i+=p*o*(g.shiftKey?10:1)/(g.ctrlKey?10:1)),t(0,i=Math.round(i/o)*o),r!==void 0&&t(0,i=Math.max(i,r)),l!==void 0&&t(0,i=Math.min(i,l)),y=g.clientX}}function E(g){$[g?"unshift":"push"](()=>{a=g,t(3,a)})}const X=g=>{t(0,i=parseFloat(g.currentTarget.value)),isNaN(i)&&t(0,i=0)};return s.$$set=g=>{"label"in g&&t(1,n=g.label),"value"in g&&t(0,i=g.value),"min"in g&&t(7,r=g.min),"max"in g&&t(8,l=g.max),"step"in g&&t(9,o=g.step),"unit"in g&&t(2,f=g.unit)},[i,n,f,a,_,b,I,r,l,o,E,X]}class H extends Wt{constructor(e){super(),qt(this,e,Pi,Ci,Ye,{label:1,value:0,min:7,max:8,step:9,unit:2})}}function $t(s){let e,t,n,i,r,l,o,f,a,y,_,b;function I(p){s[18](p)}let E={label:"radius",min:10,max:100,step:1};s[3].radius!==void 0&&(E.value=s[3].radius),n=new H({props:E}),$.push(()=>j(n,"value",I));function X(p){s[19](p)}let g={label:"mass",min:1};return s[3].mass!==void 0&&(g.value=s[3].mass),l=new H({props:g}),$.push(()=>j(l,"value",X)),{c(){e=x("hr"),t=w(),V(n.$$.fragment),r=w(),V(l.$$.fragment),f=w(),a=x("div"),a.textContent="delete selected",C(a,"class","btn svelte-ogc81v")},m(p,T){te(p,e,T),te(p,t,T),R(n,p,T),te(p,r,T),R(l,p,T),te(p,f,T),te(p,a,T),y=!0,_||(b=W(a,"click",s[20]),_=!0)},p(p,T){const Z={};!i&&T&8&&(i=!0,Z.value=p[3].radius,O(()=>i=!1)),n.$set(Z);const ee={};!o&&T&8&&(o=!0,ee.value=p[3].mass,O(()=>o=!1)),l.$set(ee)},i(p){y||(D(n.$$.fragment,p),D(l.$$.fragment,p),y=!0)},o(p){q(n.$$.fragment,p),q(l.$$.fragment,p),y=!1},d(p){p&&J(e),p&&J(t),A(n,p),p&&J(r),A(l,p),p&&J(f),p&&J(a),_=!1,b()}}}function Ii(s){let e,t,n,i,r,l,o,f,a,y,_,b,I,E,X,g,p,T,Z,ee,le,De,c,$e,Be,Ge,Ke,_e,Ue,Y,Le,Je,B,Fe,Qe,Ze,et,be,tt,G,qe,it,de,nt,st,rt,xe,lt,ce,ye=s[4]?"disable":"enable",We,ot,K,Re,at,U,Ae,ut,dt,ct,Se,ht,he,ft,oe,Ne,gt;function Gt(h){s[8](h)}let pt={label:"steps",min:1,max:1e3,step:1};s[0].settings.stepsPerFrame!==void 0&&(pt.value=s[0].settings.stepsPerFrame),g=new H({props:pt}),$.push(()=>j(g,"value",Gt));function Kt(h){s[9](h)}let mt={label:"restetution",min:0,max:1,step:.01};s[0].settings.world.restetution!==void 0&&(mt.value=s[0].settings.world.restetution),c=new H({props:mt}),$.push(()=>j(c,"value",Kt));function Ut(h){s[10](h)}let vt={label:"radius",min:10,max:100,step:1};s[0].settings.editingCircle.radius!==void 0&&(vt.value=s[0].settings.editingCircle.radius),Y=new H({props:vt}),$.push(()=>j(Y,"value",Ut));function Jt(h){s[11](h)}let wt={label:"mass",min:1};s[0].settings.editingCircle.mass!==void 0&&(wt.value=s[0].settings.editingCircle.mass),B=new H({props:wt}),$.push(()=>j(B,"value",Jt));function Qt(h){s[12](h)}let _t={label:"draw freq",min:1,max:60,step:1,unit:"Hz"};s[0].settings.traceFreq!==void 0&&(_t.value=s[0].settings.traceFreq),G=new H({props:_t}),$.push(()=>j(G,"value",Qt));function Zt(h){s[15](h)}let bt={label:"gravity",min:0,max:100,step:1};s[0].settings.world.gravity!==void 0&&(bt.value=s[0].settings.world.gravity),K=new H({props:bt}),$.push(()=>j(K,"value",Zt));function ei(h){s[16](h)}let xt={label:"velocity",min:0,max:100,step:1};s[0].settings.world.velocity!==void 0&&(xt.value=s[0].settings.world.velocity),U=new H({props:xt}),$.push(()=>j(U,"value",ei));let M=s[3]&&$t(s);return{c(){e=x("div"),t=x("div"),n=w(),i=x("div"),r=x("div"),r.textContent="Simulation",l=w(),o=x("div"),f=ne("fps: "),a=ne(s[2]),y=w(),_=x("div"),b=x("label"),b.textContent="running:",I=w(),E=x("input"),X=w(),V(g.$$.fragment),T=w(),Z=x("hr"),ee=w(),le=x("div"),le.textContent="World",De=w(),V(c.$$.fragment),Be=w(),Ge=x("hr"),Ke=w(),_e=x("div"),_e.textContent="Object",Ue=w(),V(Y.$$.fragment),Je=w(),V(B.$$.fragment),Qe=w(),Ze=x("hr"),et=w(),be=x("div"),be.textContent="Paper",tt=w(),V(G.$$.fragment),it=w(),de=x("div"),de.textContent="clear",nt=w(),st=x("hr"),rt=w(),xe=x("div"),xe.textContent="Device Motion",lt=w(),ce=x("div"),We=ne(ye),ot=w(),V(K.$$.fragment),at=w(),V(U.$$.fragment),ut=w(),dt=x("hr"),ct=w(),Se=x("div"),Se.textContent="Experiments",ht=w(),he=x("div"),he.textContent="2 Object Collision",ft=w(),M&&M.c(),C(t,"class","canvas-container svelte-ogc81v"),C(r,"class","heading svelte-ogc81v"),C(b,"for","check-running"),C(b,"class","btn svelte-ogc81v"),C(E,"type","checkbox"),C(E,"id","check-running"),C(_,"class","running svelte-ogc81v"),C(le,"class","heading svelte-ogc81v"),C(_e,"class","heading svelte-ogc81v"),C(be,"class","heading svelte-ogc81v"),C(de,"class","btn svelte-ogc81v"),C(xe,"class","heading svelte-ogc81v"),C(ce,"class","btn svelte-ogc81v"),C(Se,"class","heading svelte-ogc81v"),C(he,"class","btn svelte-ogc81v"),C(i,"class","ui svelte-ogc81v"),C(e,"class","container svelte-ogc81v")},m(h,k){te(h,e,k),u(e,t),s[6](t),u(e,n),u(e,i),u(i,r),u(i,l),u(i,o),u(o,f),u(o,a),u(i,y),u(i,_),u(_,b),u(_,I),u(_,E),E.checked=s[0].settings.running,u(i,X),R(g,i,null),u(i,T),u(i,Z),u(i,ee),u(i,le),u(i,De),R(c,i,null),u(i,Be),u(i,Ge),u(i,Ke),u(i,_e),u(i,Ue),R(Y,i,null),u(i,Je),R(B,i,null),u(i,Qe),u(i,Ze),u(i,et),u(i,be),u(i,tt),R(G,i,null),u(i,it),u(i,de),u(i,nt),u(i,st),u(i,rt),u(i,xe),u(i,lt),u(i,ce),u(ce,We),u(i,ot),R(K,i,null),u(i,at),R(U,i,null),u(i,ut),u(i,dt),u(i,ct),u(i,Se),u(i,ht),u(i,he),u(i,ft),M&&M.m(i,null),oe=!0,Ne||(gt=[W(E,"change",s[7]),W(de,"click",s[13]),W(ce,"click",s[14]),W(he,"click",s[17])],Ne=!0)},p(h,[k]){(!oe||k&4)&&ze(a,h[2]),k&1&&(E.checked=h[0].settings.running);const yt={};!p&&k&1&&(p=!0,yt.value=h[0].settings.stepsPerFrame,O(()=>p=!1)),g.$set(yt);const St={};!$e&&k&1&&($e=!0,St.value=h[0].settings.world.restetution,O(()=>$e=!1)),c.$set(St);const Et={};!Le&&k&1&&(Le=!0,Et.value=h[0].settings.editingCircle.radius,O(()=>Le=!1)),Y.$set(Et);const Ct={};!Fe&&k&1&&(Fe=!0,Ct.value=h[0].settings.editingCircle.mass,O(()=>Fe=!1)),B.$set(Ct);const Pt={};!qe&&k&1&&(qe=!0,Pt.value=h[0].settings.traceFreq,O(()=>qe=!1)),G.$set(Pt),(!oe||k&16)&&ye!==(ye=h[4]?"disable":"enable")&&ze(We,ye);const It={};!Re&&k&1&&(Re=!0,It.value=h[0].settings.world.gravity,O(()=>Re=!1)),K.$set(It);const Mt={};!Ae&&k&1&&(Ae=!0,Mt.value=h[0].settings.world.velocity,O(()=>Ae=!1)),U.$set(Mt),h[3]?M?(M.p(h,k),k&8&&D(M,1)):(M=$t(h),M.c(),D(M,1),M.m(i,null)):M&&(gi(),q(M,1,1,()=>{M=null}),pi())},i(h){oe||(D(g.$$.fragment,h),D(c.$$.fragment,h),D(Y.$$.fragment,h),D(B.$$.fragment,h),D(G.$$.fragment,h),D(K.$$.fragment,h),D(U.$$.fragment,h),D(M),oe=!0)},o(h){q(g.$$.fragment,h),q(c.$$.fragment,h),q(Y.$$.fragment,h),q(B.$$.fragment,h),q(G.$$.fragment,h),q(K.$$.fragment,h),q(U.$$.fragment,h),q(M),oe=!1},d(h){h&&J(e),s[6](null),A(g),A(c),A(Y),A(B),A(G),A(K),A(U),M&&M.d(),Ne=!1,re(gt)}}}function Mi(s,e,t){let n,i,r=Xe().toFixed(),l=d.world.motionEnabledStore;li(s,l,c=>t(4,n=c)),setInterval(c=>t(2,r=Xe().toFixed()),100);let o;d.selectedStore.subscribe(c=>{t(3,o=c)}),di(()=>{Xt(i)});function f(c){$[c?"unshift":"push"](()=>{i=c,t(1,i)})}function a(){d.running=this.checked,t(0,N)}function y(c){s.$$.not_equal(d.stepsPerFrame,c)&&(d.stepsPerFrame=c,t(0,N))}function _(c){s.$$.not_equal(d.world.restetution,c)&&(d.world.restetution=c,t(0,N))}function b(c){s.$$.not_equal(d.editingCircle.radius,c)&&(d.editingCircle.radius=c,t(0,N))}function I(c){s.$$.not_equal(d.editingCircle.mass,c)&&(d.editingCircle.mass=c,t(0,N))}function E(c){s.$$.not_equal(d.traceFreq,c)&&(d.traceFreq=c,t(0,N))}const X=c=>jt(),g=c=>Yt();function p(c){s.$$.not_equal(d.world.gravity,c)&&(d.world.gravity=c,t(0,N))}function T(c){s.$$.not_equal(d.world.velocity,c)&&(d.world.velocity=c,t(0,N))}const Z=c=>Ht("2-object-collision");function ee(c){s.$$.not_equal(o.radius,c)&&(o.radius=c,t(3,o))}function le(c){s.$$.not_equal(o.mass,c)&&(o.mass=c,t(3,o))}return[N,i,r,o,n,l,f,a,y,_,b,I,E,X,g,p,T,Z,ee,le,c=>Vt()]}class zi extends Wt{constructor(e){super(),qt(this,e,Mi,Ii,Ye,{})}}new zi({target:document.getElementById("app")});
